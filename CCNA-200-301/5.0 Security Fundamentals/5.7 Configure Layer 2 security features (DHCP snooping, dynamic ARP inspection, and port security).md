# Configure Layer 2 security features (DHCP snooping, dynamic ARP inspection, and port security)
#CCNA #IT #CyberSecurity 

## Port security
### Static
1. Statically add a specific MAC address as an allowed MAC address on the interface. On Interface config mode:
```
switchport port-security mac-address [mac address]
```

### Dynamic
2. Configure the switch to learn MAC addresses on the interface and add the to the configuration as secure MAC addresses:
```
switchport port-security mac-address sticky
```

### Violation
3. Set the maximum number of static secure MAC addresses that can assigned to a single interface:
```
switchport port-security maximum [number]
```

4. Set the violation mode. This setting will tell the switch what to do in case of an inappropriate MAC address trying to access the network through a secured port:
```
switchport port-security violation [protect | restrict | shutdown]
```

### Err-disable recovery
#### Manually
On interface config mode:
```
shutdown
no shutdown
```

#### Automatic
On global config mode. Enables error recovery feature when the interface is error disabled because of a port security violation (E.g. number of MAC addresses allowed is exceeded).
```
errdisable recovery cause psecure-violation
```

Sets the time to wait before recovering from an interface err-disabled state (regardless of the cause of the err-disabled state)
```
errdisable recovery interval [seconds]
```



## DHCP Snooping

1. In global config mode, run the following command to enable DHCP Snooping on the switch:
```
ip dhcp snooping
```

2. In global config mode, run the following command to enable DHCP Snooping on a specific VLAN:
```
ip dhcp Snooping vlan [vlan-list]
```
Note: These two commands are required to enable DHCP Snooping.

### Trusted interface
By default DHCP snooping places all interfaces as untrusted. If we want to change this, as in the case of an interface directly connected to a router or to another switch, we can do so as follows:
In interface config mode.
```
ip dhcp snooping trust
```

### Optional features
Disable the insertion of DHCP Option 82 data into DHCP messages, specifically on L2 switches that do not act as DHCP relay agent. In global config mode run:
```
no ip dhcp snooping information option
```

### Rate limit
By default, there's no rate limit for violations. If we want to change this run the following commands in Interface config mode:
#### Enable rate limit
```
ip dhcp snooping limit rate [seconds]
```
#### Disable rate limit
```
no ip dhcp snooping limit rate [seconds]
```

### Err-disable recovery

In global config mode. Enables error recovery feature when the port is error disabled due to DHCP rate limit violation.
```
errdisable recovery cause dhcp-rate-limit
```


```
errdisable recovery interval [seconds]
```



## ARP inspection
Separate from these steps, configure DHCP Snooping and /or ARP ACLs for use by DAI

1. Run the following command in global config mode to enable DAI on the switch for a specific VLAN:
```
ip arp inspection vlan [vlan list]
```
2. Configure trusted interfaces as follows. On interface config mode run:
```
ip arp inspection trust
```

### Optional features
You can also configure some optional features such as DAI rate limit and err-disabled recovery.
#### Rate limit
Interface subcommand. Sets a limit of ARP messages per second, or ARP messages for each configured interval:
```
ip arp inspection limit rate [burst interval | seconds]
```

Interface subcommand. Disables rate limits:
```
ip arp inspection limit rate none 
```

#### Err-disable recovery
Global command. Enables the feature of automatic recovery from err-disable mode, assuming the switch placed the port in this state because of exceeding DAI rate limits:
```
errdisable recovery cause arp-inspection
```

Global command. Sets the time to wait before recovering from an interface err-disabled state (regardless of the cause of the err-disabled state)
```
errdisable recovery interval [seconds]
```

#### DAI validation
The following command is for adding validation steps:
```
ip arp inspection validate {[dst-mac] [src-mac] [ip]]}
```


## Example
Complete working DAI configuration that adds the DHCP Snooping configuration:
```
ip arp inspection vlan 11 
ip dhcp snooping 
ip dhcp snooping vlan 11 
no ip dhcp snooping information option 
! 
interface GigabitEthernet1/0/2 
ip dhcp snooping trust 
ip arp inspection trust
```

